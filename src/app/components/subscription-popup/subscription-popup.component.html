<div class="popup-overlay" *ngIf="isVisible" (click)="close()">
    <div class="popup-content" (click)="$event.stopPropagation()">
        <!-- Close Button -->
        <button class="close-btn" (click)="close()" aria-label="Close popup" title="Close">
            <i class="fas fa-times"></i>
        </button>

        <!-- Logo -->
        <div class="logo-container" *ngIf="!submitted">
            <img src="/public/icon-UFeed.png" alt="UFeed" class="logo-image" />
        </div>

        <!-- Title -->
        <h2 class="popup-title" *ngIf="!submitted">
            October Special Offer
        </h2>

        <!-- Messages -->
        <div class="messages-container" *ngIf="!submitted">
            <p class="message-text">
                <strong>UFEED</strong> will be supporting Egyptian companies â€” up to <strong>52 companies</strong> this month, until the end of October â€” with its tools (<strong>JET, EES</strong>), either fully or partially for free.
            </p>
        </div>

        <!-- Registration Form -->
        <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()" class="registration-form" *ngIf="!submitted">
            <!-- Error Message -->
            <div class="form-error" *ngIf="submitError">
                <i class="fas fa-exclamation-circle"></i>
                <span>{{ submitError }}</span>
            </div>
            
            <!-- 2x2 Grid for first 4 inputs -->
            <div class="form-grid">
                <div class="form-group">
                    <label for="fullName">Full Name <span class="required">*</span></label>
                    <input 
                        id="fullName" 
                        type="text" 
                        formControlName="fullName"
                        placeholder="Enter your full name"
                        [class.error]="fullName.invalid && (fullName.dirty || fullName.touched)">
                    <div class="error-message" *ngIf="fullName.invalid && (fullName.dirty || fullName.touched)">
                        <span *ngIf="fullName.errors?.['required']">Full name is required</span>
                        <span *ngIf="fullName.errors?.['minlength']">Name must be at least 3 characters</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="phoneNumber">Phone Number <span class="required">*</span></label>
                    <input 
                        id="phoneNumber" 
                        type="tel" 
                        formControlName="phoneNumber"
                        placeholder="Enter your phone number"
                        [class.error]="phoneNumber.invalid && (phoneNumber.dirty || phoneNumber.touched)">
                    <div class="error-message" *ngIf="phoneNumber.invalid && (phoneNumber.dirty || phoneNumber.touched)">
                        <span *ngIf="phoneNumber.errors?.['required']">Phone number is required</span>
                        <span *ngIf="phoneNumber.errors?.['pattern']">Please enter a valid phone number (10-15 digits)</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email">Email Address <span class="required">*</span></label>
                    <input 
                        id="email" 
                        type="email" 
                        formControlName="email"
                        placeholder="Enter your email address"
                        [class.error]="email.invalid && (email.dirty || email.touched)">
                    <div class="error-message" *ngIf="email.invalid && (email.dirty || email.touched)">
                        <span *ngIf="email.errors?.['required']">Email is required</span>
                        <span *ngIf="email.errors?.['email']">Please enter a valid email address</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="companyName">Company Name <span class="required">*</span></label>
                    <input 
                        id="companyName" 
                        type="text" 
                        formControlName="companyName"
                        placeholder="Enter your company name"
                        [class.error]="companyName.invalid && (companyName.dirty || companyName.touched)">
                    <div class="error-message" *ngIf="companyName.invalid && (companyName.dirty || companyName.touched)">
                        <span *ngIf="companyName.errors?.['required']">Company name is required</span>
                        <span *ngIf="companyName.errors?.['minlength']">Company name must be at least 2 characters</span>
                    </div>
                </div>
            </div>

            <!-- Full width for last input -->
            <div class="form-group">
                <label for="jobPosition">Job Position <span class="required">*</span></label>
                <input 
                    id="jobPosition" 
                    type="text" 
                    formControlName="jobPosition"
                    placeholder="Enter your job position"
                    [class.error]="jobPosition.invalid && (jobPosition.dirty || jobPosition.touched)">
                <div class="error-message" *ngIf="jobPosition.invalid && (jobPosition.dirty || jobPosition.touched)">
                    <span *ngIf="jobPosition.errors?.['required']">Job position is required</span>
                    <span *ngIf="jobPosition.errors?.['minlength']">Job position must be at least 2 characters</span>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-primary" [disabled]="registrationForm.invalid || isSubmitting">
                <span *ngIf="!isSubmitting">
                    Register Now
                    <i class="fas fa-arrow-right"></i>
                </span>
                <span *ngIf="isSubmitting" class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    Submitting...
                </span>
            </button>
        </form>

        <!-- Success Message -->
        <div class="success-message" *ngIf="submitted">
            <div class="success-icon-wrapper">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Registration Successful!</h3>
            <p class="success-description">
                Thank you for registering for the October Special Offer! ðŸŽ‰
            </p>
            <p class="success-info">
                Our team will review your application and contact you within <strong>24-48 hours</strong> with more details about accessing <strong>JET</strong> and <strong>EES</strong> tools.
            </p>
            
            <div class="success-details">
                <div class="detail-item">
                    <i class="fas fa-envelope"></i>
                    <span>Check your email for confirmation</span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-phone"></i>
                    <span>We'll call you to discuss your needs</span>
                </div>
            </div>

            <div class="success-actions">
                <button class="btn-secondary" (click)="close()">
                    Close
                </button>
                <div class="auto-close-info" *ngIf="countdownInterval">
                    <i class="fas fa-clock"></i>
                    Auto-closing in {{ autoCloseTimer }}s
                    <button class="btn-link" (click)="cancelAutoClose()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>